<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1513px" preserveAspectRatio="none" style="width:1731px;height:1513px;" version="1.1" viewBox="0 0 1731 1513" width="1731px" zoomAndPan="magnify"><defs><filter height="300%" id="fjo68xjsgl8se" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#FF0000" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="77" x="1642" y="9.2822">File upload UML</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="97" x="1622" y="20.9229">(c) Andy Bulka 2019</text><!--MD5=[2ee341e1ab3c6e48c4c7cbc2817a21d5]
class urls--><rect fill="#FEFECE" filter="url(#fjo68xjsgl8se)" height="113.9609" id="urls" style="stroke: #A80036; stroke-width: 1.5;" width="466" x="6" y="62.2813"/><ellipse cx="21" cy="81.25" fill="#FF7700" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M17.9063,79.6406 L17.9063,84.5469 L18.5156,84.5469 C18.9688,84.5469 19.1094,84.5781 19.2969,84.7031 C19.5156,84.875 19.625,85.125 19.625,85.4063 C19.625,85.6875 19.4844,85.9688 19.2188,86.125 C19.1094,86.2031 18.8438,86.25 18.5156,86.25 L16.3125,86.25 C15.9063,86.25 15.6875,86.2031 15.5313,86.0781 C15.3125,85.9219 15.1719,85.6719 15.1719,85.4063 C15.1719,84.8594 15.5469,84.5469 16.2188,84.5469 L16.2188,78.0313 C15.6563,77.9844 15.3281,77.6875 15.3281,77.1719 C15.3281,76.9063 15.4844,76.6094 15.7344,76.4375 C15.8281,76.3906 16.1875,76.3281 16.3906,76.3281 C16.4219,76.3281 16.4375,76.3281 16.4531,76.3438 L18.3125,76.3438 L20.6563,81.3906 L22.9531,76.3438 L24.8125,76.3438 C25.2813,76.3438 25.4219,76.375 25.5938,76.4844 C25.7969,76.6563 25.9375,76.9219 25.9375,77.1875 C25.9375,77.6875 25.6094,77.9844 25.0469,78.0313 L25.0469,84.5469 C25.7188,84.5469 26.0938,84.8594 26.0938,85.4063 C26.0938,85.6875 25.9375,85.9688 25.6875,86.125 C25.5625,86.2031 25.3125,86.25 24.9688,86.25 L22.7656,86.25 C22.375,86.25 22.125,86.2031 22,86.0781 C21.7656,85.9219 21.6406,85.6563 21.6406,85.4063 C21.6406,85.1094 21.7969,84.8281 22.0469,84.6719 C22.2031,84.5625 22.3125,84.5469 22.7656,84.5469 L23.3594,84.5469 L23.3594,79.6406 L21.4688,83.9063 L19.9219,83.9063 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="127" x="33" y="78.4199">«singlepage/urls.py»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="23" x="85" y="92.3887">urls</text><rect fill="#FFFFFF" height="15.9688" style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" width="309" x="166" y="59.2813"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="299" x="171" y="71.4199">START HERE: when user clicks on file upload link</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="471" y1="100.2188" y2="100.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="76" x="12" y="131.2339">/fileupload -&gt;</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="91" x="100" y="131.2339">views.fileupload</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="195" y="131.2339"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="7" x="195" y="131.2339">1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="206" y="131.2339"/><text fill="#FF0000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="131" x="210" y="131.2339">* main user start point</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="16" y="144.0386"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="82" x="12" y="156.8433">/upload_file -&gt;</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="97" x="106" y="156.8433">views.upload_file</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="186" x="12" y="169.6479">/file_upload_uml/&lt;str:event&gt;/ -&gt;</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="124" x="210" y="169.6479">views.file_upload_uml</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="7" x2="207.5" y1="114.6211" y2="114.6211"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="63" x="207.5" y="117.9292">urlpatterns</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="270.5" x2="471" y1="114.6211" y2="114.6211"/><!--MD5=[f57c53f854481d44bdae29012291a95b]
class views--><rect fill="#FEFECE" filter="url(#fjo68xjsgl8se)" height="923.3438" id="views" style="stroke: #A80036; stroke-width: 1.5;" width="561" x="434.5" y="284.2813"/><ellipse cx="641.75" cy="303.25" fill="#FF7700" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M638.6563,301.6406 L638.6563,306.5469 L639.2656,306.5469 C639.7188,306.5469 639.8594,306.5781 640.0469,306.7031 C640.2656,306.875 640.375,307.125 640.375,307.4063 C640.375,307.6875 640.2344,307.9688 639.9688,308.125 C639.8594,308.2031 639.5938,308.25 639.2656,308.25 L637.0625,308.25 C636.6563,308.25 636.4375,308.2031 636.2813,308.0781 C636.0625,307.9219 635.9219,307.6719 635.9219,307.4063 C635.9219,306.8594 636.2969,306.5469 636.9688,306.5469 L636.9688,300.0313 C636.4063,299.9844 636.0781,299.6875 636.0781,299.1719 C636.0781,298.9063 636.2344,298.6094 636.4844,298.4375 C636.5781,298.3906 636.9375,298.3281 637.1406,298.3281 C637.1719,298.3281 637.1875,298.3281 637.2031,298.3438 L639.0625,298.3438 L641.4063,303.3906 L643.7031,298.3438 L645.5625,298.3438 C646.0313,298.3438 646.1719,298.375 646.3438,298.4844 C646.5469,298.6563 646.6875,298.9219 646.6875,299.1875 C646.6875,299.6875 646.3594,299.9844 645.7969,300.0313 L645.7969,306.5469 C646.4688,306.5469 646.8438,306.8594 646.8438,307.4063 C646.8438,307.6875 646.6875,307.9688 646.4375,308.125 C646.3125,308.2031 646.0625,308.25 645.7188,308.25 L643.5156,308.25 C643.125,308.25 642.875,308.2031 642.75,308.0781 C642.5156,307.9219 642.3906,307.6563 642.3906,307.4063 C642.3906,307.1094 642.5469,306.8281 642.7969,306.6719 C642.9531,306.5625 643.0625,306.5469 643.5156,306.5469 L644.1094,306.5469 L644.1094,301.6406 L642.2188,305.9063 L640.6719,305.9063 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="142" x="660.25" y="300.4199">« singlepage.views.py»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="33" x="714.75" y="314.3887">views</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="435.5" x2="994.5" y1="322.2188" y2="322.2188"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="448.5" y="353.2339"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="11" x="448.5" y="353.2339">1.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="129" x="444.5" y="366.0386">return render(request,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="5" x="472.5" y="378.8433">"</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="477.5" y="378.8433">fileupload.html</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="135" x="574.5" y="378.8433">", {"object_list": None})</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="721.5" y="378.8433"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="11" x="721.5" y="378.8433">2.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="391.6479"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="435.5" x2="648.5" y1="336.6211" y2="336.6211"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="133" x="648.5" y="339.9292">def fileupload(request):</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="781.5" x2="994.5" y1="336.6211" y2="336.6211"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="448.5" y="421.2573"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="11" x="448.5" y="421.2573">3.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="408" x="440.5" y="434.062">Calculates an "event" based on the user name and date, and stores all</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="271" x="440.5" y="446.8667">uploaded files in a directory UPLOAD_DIR/event.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="459.6714"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="353" x="444.5" y="472.4761">form = FileUploadForm(request.POST, request.FILES or None)</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="143" x="444.5" y="485.2808">file = request.FILES['file']</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="444.5" y="498.0854">event =</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="492.5" y="498.0854">calc_upload_eventdir</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="229" x="627.5" y="498.0854">(request.user, datetime.datetime.now())</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="215" x="444.5" y="510.8901">dir = os.path.join(UPLOAD_DIR, event)</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="193" x="444.5" y="523.6948">path = os.path.join(dir, file.name)</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="536.4995"/><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="444.5" y="536.4995">handle_uploaded_file</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="581.5" y="536.4995">(file, path)</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="655.5" y="536.4995"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="18" x="655.5" y="536.4995">A1.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="549.3042"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="414" x="444.5" y="562.1089">return HttpResponse(json.dumps(data), content_type="application/json")</text><text fill="#FF0000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="164" x="440.5" y="574.9136">Typical AJAX HttpResponse is</text><text fill="#808080" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="216" x="448.5" y="588.6465">&lt;class 'dict'&gt;: {'status': 'success',</text><text fill="#808080" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="516.5" y="602.6152">'file': 'display_model.py',</text><text fill="#808080" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="249" x="516.5" y="616.584">'event': 'admin-1-2019-04-17-12:12:47'}</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="629.6245"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="435.5" x2="614" y1="404.6445" y2="404.6445"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="202" x="614" y="407.9526">def upload_file(request, uid=None):</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="816" x2="994.5" y1="404.6445" y2="404.6445"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="448.5" y="659.2339"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="18" x="448.5" y="659.2339">A1.</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="439" x="440.5" y="672.0386">This should be changed to using memcache rather than the local file system!</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="325" x="444.5" y="684.8433">path = os.path.join('uploaded', file.name)  # work out dir</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="307" x="444.5" y="697.6479">os.makedirs(os.path.dirname(path))  # and create dir</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="467" x="444.5" y="710.4526">with open(path, 'wb+') as destination: ... destination.write(chunk) # writes out file</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="723.2573"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="435.5" x2="594.5" y1="642.6211" y2="642.6211"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="241" x="594.5" y="645.9292">def handle_uploaded_file(file, path=None):</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="835.5" x2="994.5" y1="642.6211" y2="642.6211"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="452.5" y="752.8667"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="11" x="452.5" y="752.8667">4.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="452.5" y="765.6714"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="11" x="452.5" y="765.6714">6.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="311" x="440.5" y="778.4761">Called when all files have been successfully uploaded.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="260" x="440.5" y="791.2808">"event" gives us a way to refer to those files.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="509" x="440.5" y="804.0854">Combines custom plantumltext (which initially will be blank) into a UML diagram based on</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="36" x="953.5" y="804.0854">paths</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="816.8901"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="223" x="444.5" y="829.6948">image_url, generated_plant_uml_text =</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="671.5" y="829.6948">uploaded_local_paths_to_uml_url</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="4" x="881.5" y="829.6948">(</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="460.5" y="842.4995"/><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="36" x="460.5" y="842.4995">paths</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="235" x="496.5" y="842.4995">, custom_plant_uml_text, ..., options_uml</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="4" x="460.5" y="855.3042">)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="868.1089"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="126" x="440.5" y="880.9136">then where do we go?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="289" x="440.5" y="893.7183">well, we render the "fileupload_uml.html" template</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="906.5229"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="365" x="444.5" y="919.3276">form = MyFileUploadForm(initial={"custom_plant_uml_text": ""})</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="932.1323"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="46" x="440.5" y="944.937">which is</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="215" x="444.5" y="957.7417">class MyFileUploadForm(forms.Form):</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="242" x="452.5" y="970.5464">custom_plant_uml_text = forms.CharField(</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="462" x="468.5" y="983.3511">label="Additional custom plantuml text", required=False, widget=forms.Textarea</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="4" x="452.5" y="996.1558">)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="291" x="440.5" y="1008.9604">Note that it is not inheriting from forms.ModelForm</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="1021.7651"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="81" x="444.5" y="1034.5698">return render(</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="48" x="460.5" y="1047.3745">request,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="125" x="460.5" y="1060.1792">"fileupload_uml.html",</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="601.5" y="1060.1792"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="11" x="601.5" y="1060.1792">5.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="7" x="460.5" y="1072.9839">{</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="152" x="476.5" y="1085.7886">"python_text": python_text,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="162" x="476.5" y="1098.5933"># "show_python_text": True,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="314" x="476.5" y="1111.3979">"generated_plant_uml_text": generated_plant_uml_text,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="181" x="476.5" y="1124.2026">"custom_plant_uml_text": None,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="134" x="476.5" y="1137.0073">"image_url": image_url,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="76" x="476.5" y="1149.812">"form": form,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="84" x="476.5" y="1162.6167">"event": event,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="122" x="476.5" y="1175.4214">"paths_ro": paths_ro,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="11" x="460.5" y="1188.2261">},</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="444.5" y="1201.0308"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="435.5" x2="612.5" y1="736.2539" y2="736.2539"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="205" x="612.5" y="739.562">def file_upload_uml(request, event):</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="817.5" x2="994.5" y1="736.2539" y2="736.2539"/><!--MD5=[8cc017fdbdc8d0edac236ffe8a6125cc]
class fileupload--><rect fill="#FEFECE" filter="url(#fjo68xjsgl8se)" height="203.5938" id="fileupload" style="stroke: #A80036; stroke-width: 1.5;" width="519" x="455.5" y="1299.2813"/><ellipse cx="590.75" cy="1318.25" fill="#FF7700" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M591.1875,1315.7813 L591.1875,1322.2969 L592.3125,1322.2969 C592.7656,1322.2969 592.9063,1322.3281 593.0625,1322.4531 C593.2969,1322.625 593.4219,1322.875 593.4219,1323.1563 C593.4219,1323.4375 593.2813,1323.7344 593.0156,1323.875 C592.9063,1323.9531 592.6406,1324 592.3125,1324 L588.375,1324 C587.9844,1324 587.7656,1323.9531 587.6094,1323.8281 C587.3906,1323.6719 587.25,1323.4063 587.25,1323.1563 C587.25,1322.8594 587.4063,1322.5781 587.6563,1322.4219 C587.8125,1322.3125 587.9375,1322.2969 588.375,1322.2969 L589.4844,1322.2969 L589.4844,1315.7813 L587.6563,1315.7813 L587.6563,1317.375 C587.6563,1317.8281 587.625,1317.9688 587.5156,1318.1406 C587.3438,1318.3594 587.0938,1318.4844 586.8125,1318.4844 C586.5313,1318.4844 586.2344,1318.3438 586.0781,1318.0781 C586,1317.9375 585.9688,1317.7656 585.9688,1317.375 L585.9688,1314.0938 L594.7344,1314.0938 L594.7344,1317.375 C594.7344,1317.8438 594.7188,1317.9688 594.5781,1318.1406 C594.4063,1318.3594 594.1563,1318.4844 593.8906,1318.4844 C593.5938,1318.4844 593.3125,1318.3281 593.1563,1318.0781 C593.0625,1317.9375 593.0313,1317.7656 593.0313,1317.375 L593.0313,1315.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="244" x="609.25" y="1315.4199">«singlepage/templates/fileupload.html»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="61" x="700.75" y="1329.3887">fileupload</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="456.5" x2="973.5" y1="1337.2188" y2="1337.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="438" x="461.5" y="1351.4292">Change /upload-target to your upload address, in this case it is "upload_file"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="68" x="461.5" y="1364.2339">for each file</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="465.5" y="1377.0386"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="473.5" y="1389.8433"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="11" x="473.5" y="1389.8433">3.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="131" x="465.5" y="1402.6479">&lt;form action="{% url '</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="596.5" y="1402.6479">upload_file</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="301" x="667.5" y="1402.6479">' %}" class="dropzone" id="myAwesomeDropzone"&gt;</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="101" x="481.5" y="1415.4526">{% csrf_token %}</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="49" x="465.5" y="1428.2573">&lt;/form&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="191" x="461.5" y="1457.8667">once all files have been uploaded</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="204" x="465.5" y="1470.6714">function submit_upload_uml_event()</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="150" x="481.5" y="1483.4761">event = last_upload_event</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="137" x="481.5" y="1496.2808">window.location.href = '</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="194" x="618.5" y="1496.2808">file_upload_uml/[object Event]</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="3" x="812.5" y="1496.2808">'</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="835.5" y="1496.2808"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="11" x="835.5" y="1496.2808">4.</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="456.5" x2="687.5" y1="1441.2539" y2="1441.2539"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="55" x="687.5" y="1444.562">javascript</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="742.5" x2="973.5" y1="1441.2539" y2="1441.2539"/><!--MD5=[db6ee206169267298d76e073d65969b4]
class fileupload_uml--><rect fill="#FEFECE" filter="url(#fjo68xjsgl8se)" height="105.1563" id="fileupload_uml" style="stroke: #A80036; stroke-width: 1.5;" width="410" x="1291" y="693.2813"/><ellipse cx="1357.75" cy="712.25" fill="#FF7700" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1358.1875,709.7813 L1358.1875,716.2969 L1359.3125,716.2969 C1359.7656,716.2969 1359.9063,716.3281 1360.0625,716.4531 C1360.2969,716.625 1360.4219,716.875 1360.4219,717.1563 C1360.4219,717.4375 1360.2813,717.7344 1360.0156,717.875 C1359.9063,717.9531 1359.6406,718 1359.3125,718 L1355.375,718 C1354.9844,718 1354.7656,717.9531 1354.6094,717.8281 C1354.3906,717.6719 1354.25,717.4063 1354.25,717.1563 C1354.25,716.8594 1354.4063,716.5781 1354.6563,716.4219 C1354.8125,716.3125 1354.9375,716.2969 1355.375,716.2969 L1356.4844,716.2969 L1356.4844,709.7813 L1354.6563,709.7813 L1354.6563,711.375 C1354.6563,711.8281 1354.625,711.9688 1354.5156,712.1406 C1354.3438,712.3594 1354.0938,712.4844 1353.8125,712.4844 C1353.5313,712.4844 1353.2344,712.3438 1353.0781,712.0781 C1353,711.9375 1352.9688,711.7656 1352.9688,711.375 L1352.9688,708.0938 L1361.7344,708.0938 L1361.7344,711.375 C1361.7344,711.8438 1361.7188,711.9688 1361.5781,712.1406 C1361.4063,712.3594 1361.1563,712.4844 1360.8906,712.4844 C1360.5938,712.4844 1360.3125,712.3281 1360.1563,712.0781 C1360.0625,711.9375 1360.0313,711.7656 1360.0313,711.375 L1360.0313,709.7813 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="272" x="1376.25" y="709.4199">«singlepage/templates/fileupload_uml.html»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="89" x="1467.75" y="723.3887">fileupload_uml</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1292" x2="1700" y1="731.2188" y2="731.2188"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="348" x="1297" y="745.4292">Actually displays the UML diagram.  The only thing we upload</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="398" x="1297" y="758.2339">via the form is the custom plantuml. The "event" parameter of the url</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="182" x="1297" y="771.0386">lets us find the source files etc.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="383" x="1301" y="783.8433">&lt;form action={% url 'file_upload_uml' event %}  method="POST"&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1292" x2="1700" y1="790.4375" y2="790.4375"/><path d="M507,83.7813 L507,154.3125 L923,154.3125 L923,93.7813 L913,83.7813 L507,83.7813 " fill="#FBFB77" filter="url(#fjo68xjsgl8se)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M913,83.7813 L913,93.7813 L923,93.7813 L913,83.7813 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="345" x="513" y="100.8481">upload_file() is called multiple times, once for each file</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="391" x="513" y="115.981">passing back (in the AJAX response) the first calculated event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="381" x="513" y="131.1138">to the javascript so that all subsequent files get put into the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="513" y="146.2466">same event/directory</text><path d="M1143,31.2813 L1143,207.7422 L1477,207.7422 L1477,41.2813 L1467,31.2813 L1143,31.2813 " fill="#FBFB77" filter="url(#fjo68xjsgl8se)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1467,31.2813 L1467,41.2813 L1477,41.2813 L1467,31.2813 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="1149" y="48.3481">views.fileupload_uml()</text><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1305" y="48.3481"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="1305" y="48.3481">4.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1321" y="48.3481">is called automatically</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="1149" y="63.481">after the initial file upload, to render the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="1149" y="78.6138">initial UML.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1153" y="93.7466"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="1149" y="108.8794">views.fileupload_uml()</text><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1305" y="108.8794"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="1305" y="108.8794">6.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1321" y="108.8794">is called by the user</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="305" x="1149" y="124.0122">pressing "Generate UML" button on subsequent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="282" x="1149" y="139.145">renderings, as the UML is refined, by fiddling</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="1149" y="154.2778">with custom plantuml text.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1157" y="169.4106"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="251" x="1149" y="184.5435">(the user cannot edit info/classes etc in</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="246" x="1153" y="199.6763">the uploaded Python files themselves)</text><!--MD5=[09120dea1eacb4adcb82378279176969]
link urls to views--><path d="M281.871,176.5313 C317.848,223.7313 372.651,295.6312 431.302,372.5812 " fill="none" id="urls-&gt;views" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="434.454,376.7113,432.1621,367.1328,431.4158,372.7402,425.8084,371.9939,434.454,376.7113" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="344" y="250.3481"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="344" y="250.3481">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="360" y="250.3481">fileupload()</text><!--MD5=[ffe3e3ee9dc4358597c81f0535ccc61a]
link views to fileupload--><path d="M542.711,1207.2903 C546.487,1228.4493 552.762,1249.2113 562,1269.2813 C566.071,1278.1263 571.066,1286.5963 576.737,1294.6693 " fill="none" id="views-&gt;fileupload" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="579.955,1299.1132,577.916,1289.4778,577.0224,1295.0636,571.4366,1294.1699,579.955,1299.1132" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="582.5" y="1250.3481"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="582.5" y="1250.3481">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="598.5" y="1250.3481">fileupload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="567" y="1265.481">template render</text><!--MD5=[03f9cf74cfeae6a5520877ea6bee28fb]
link fileupload to views--><path d="M712.452,1299.0863 C712.267,1289.0172 712.111,1278.9493 712,1269.2813 C711.788,1250.7293 711.628,1231.8073 711.515,1212.6923 " fill="none" id="fileupload-&gt;views" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="711.484,1207.2953,707.5355,1216.318,711.5126,1212.2952,715.5354,1216.2722,711.484,1207.2953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="739.5" y="1250.3481"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="739.5" y="1250.3481">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="755.5" y="1250.3481">upload_file(data)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="713" y="1265.481">once for each file via AJAX</text><!--MD5=[03f9cf74cfeae6a5520877ea6bee28fb]
link fileupload to views--><path d="M862.975,1299.2643 C870.363,1289.8843 876.841,1279.8843 882,1269.2813 C890.978,1250.8283 897.261,1231.7793 901.24,1212.3653 " fill="none" id="fileupload-&gt;views-1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="902.202,1207.4223,896.558,1215.4935,901.2478,1212.3304,904.4109,1217.0202,902.202,1207.4223" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="907" y="1250.3481"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="907" y="1250.3481">4.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="923" y="1250.3481">file_upload_uml/[object Event]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="913.5" y="1265.481">once all have been uploaded</text><!--MD5=[cddd192e01fe3b74630b2860d1a04689]
link views to fileupload_uml--><path d="M995.58,745.7813 C1091.31,745.7813 1196.64,745.7813 1285.87,745.7813 " fill="none" id="views-&gt;fileupload_uml" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1290.91,745.7813,1281.91,741.7813,1285.91,745.7813,1281.91,749.7813,1290.91,745.7813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1021.75" y="723.8481"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="1021.75" y="723.8481">5.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="1037.75" y="723.8481">fileupload_uml(image_url, form, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="1077.25" y="738.981">template render UML</text><!--MD5=[0cca9166073524ec94a29c7be6c36ff1]
link fileupload_uml to views--><path d="M1290.8,778.0823 C1280.48,779.1293 1270.26,780.0423 1260.25,780.7813 C1156.53,788.4383 1130.09,786.6013 1026.25,780.7813 C1017.93,780.3153 1009.5,779.7793 1000.983,779.1843 " fill="none" id="fileupload_uml-&gt;views" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="995.674,778.8063,1004.3666,783.4364,1000.6613,779.162,1004.9358,775.4567,995.674,778.8063" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1039.25" y="761.8481"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="1039.25" y="761.8481">6.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="1055.25" y="761.8481">file_upload_uml/[object Event]</text><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1259.25" y="761.8481"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="1070.75" y="776.981">to regenerate the UML</text><!--MD5=[f67dbca5065fe18d82e69bde4cf3096d]
link N1 to views--><path d="M708.73,155.1913 C706.403,184.6713 704.704,230.5512 703.63,284.0013 " fill="none" id="N1-views" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--MD5=[f67dbca5065fe18d82e69bde4cf3096d]
link N1 to views--><!--MD5=[58aab5ad28c64ade5f22c16225310adb]
link N2 to fileupload_uml--><path d="M1335.96,207.4413 C1375.27,339.4313 1448.69,585.9323 1480.57,692.9643 " fill="none" id="N2-fileupload_uml" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--MD5=[80318a571f26cbb2d05b564a67b90dfb]
link N2 to views--><path d="M1226.95,207.4413 C1166.24,271.1713 1080.08,361.6012 995.728,450.1312 " fill="none" id="N2-views" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--MD5=[b95a1563d99dcb6a30413fa2748829e0]
@startuml More complete example of a Literate Code Map - 02


header
<font color=red>File upload UML</font>
(c) Andy Bulka 2019
endheader

class urls < START HERE: when user clicks on file upload link ><<(M,#FF7700) singlepage/urls.py>>{
    .. urlpatterns ..
    /fileupload -> <color:royalBlue>  views.fileupload</color> <u>1</u> <color:Red> * main user start point
    
    /upload_file -> <color:royalBlue>  views.upload_file
    /file_upload_uml/<str:event>/ -> <color:royalBlue>  views.file_upload_uml
}

class views <<(M,#FF7700)  singlepage.views.py>> {
    .. def fileupload(request): ..
        <color:royalBlue>  <u>1.</u></color>
        <color:royalBlue> return render(request, 
        <color:royalBlue>\t"<b>fileupload.html</b>", {"object_list": None}) <color:royalBlue>  <u>2.</u></color>

    .. def upload_file(request, uid=None): ..
    <color:royalBlue>  <u>3.</u></color>
    Calculates an "event" based on the user name and date, and stores all
    uploaded files in a directory UPLOAD_DIR/event.
      
    <color:royalBlue> form = FileUploadForm(request.POST, request.FILES or None)
    <color:royalBlue> file = request.FILES['file']
    <color:royalBlue> event = <b>calc_upload_eventdir</b>(request.user, datetime.datetime.now())
    <color:royalBlue> dir = os.path.join(UPLOAD_DIR, event)
    <color:royalBlue> path = os.path.join(dir, file.name)
    <color:royalBlue> <b>handle_uploaded_file</b>(file, path)  <color:royalBlue>  <u>A1.</u></color>

    <color:royalBlue> return HttpResponse(json.dumps(data), content_type="application/json")
    <color:Red>Typical AJAX HttpResponse is
    <color:Gray><size:12>  <class 'dict'>: {'status': 'success', 
    <color:Gray><size:12>                   'file': 'display_model.py', 
    <color:Gray><size:12>                   'event': 'admin-1-2019-04-17-12:12:47'}

    .. def handle_uploaded_file(file, path=None): ..
    <color:royalBlue>  <u>A1.</u></color>
    <i>This should be changed to using memcache rather than the local file system!</i>
    <color:royalBlue> path = os.path.join('uploaded', file.name)  # work out dir 
    <color:royalBlue> os.makedirs(os.path.dirname(path))  # and create dir
    <color:royalBlue> with open(path, 'wb+') as destination: ... destination.write(chunk) # writes out file
    
    .. def file_upload_uml(request, event): ..
    <color:royalBlue>   <u>4.</u></color>
    <color:royalBlue>   <u>6.</u></color>
    Called when all files have been successfully uploaded.
    "event" gives us a way to refer to those files.
    Combines custom plantumltext (which initially will be blank) into a UML diagram based on <b>paths</b>
    
    <color:royalBlue> image_url, generated_plant_uml_text = <b>uploaded_local_paths_to_uml_url</b>(
    <color:royalBlue>     <b>paths</b>, custom_plant_uml_text, ..., options_uml
    <color:royalBlue>     )
    
    then where do we go?
    well, we render the "fileupload_uml.html" template
    
    <color:royalBlue> form = MyFileUploadForm(initial={"custom_plant_uml_text": ""})

    which is
    <color:royalBlue> class MyFileUploadForm(forms.Form):
    <color:royalBlue>   custom_plant_uml_text = forms.CharField(
    <color:royalBlue>       label="Additional custom plantuml text", required=False, widget=forms.Textarea
    <color:royalBlue>   )
    Note that it is not inheriting from forms.ModelForm
     
    <color:royalBlue> return render(
    <color:royalBlue>     request,
    <color:royalBlue>     "fileupload_uml.html",  <color:royalBlue>  <u>5.</u></color>
    <color:royalBlue>     {
    <color:royalBlue>         "python_text": python_text,
    <color:royalBlue>         # "show_python_text": True,
    <color:royalBlue>         "generated_plant_uml_text": generated_plant_uml_text,
    <color:royalBlue>         "custom_plant_uml_text": None,
    <color:royalBlue>         "image_url": image_url,
    <color:royalBlue>         "form": form,
    <color:royalBlue>         "event": event,
    <color:royalBlue>         "paths_ro": paths_ro,
    <color:royalBlue>     },    
    <color:royalBlue> 
}

class fileupload <<(T,#FF7700) singlepage/templates/fileupload.html>> {
    Change /upload-target to your upload address, in this case it is "upload_file"
    for each file

    <color:royalBlue>   <u>3.</u></color>
    <color:royalBlue> <form action="{% url '<b>upload_file</b>' %}" class="dropzone" id="myAwesomeDropzone">
    <color:royalBlue>     {% csrf_token %}
    <color:royalBlue> </form>
    .. javascript ..
    once all files have been uploaded
    <color:royalBlue> function submit_upload_uml_event()
    <color:royalBlue>     event = last_upload_event
    <color:royalBlue>     window.location.href = '<b>file_upload_uml/[object Event]</b>'  <color:royalBlue>   <u>4.</u></color>
}

class fileupload_uml <<(T,#FF7700) singlepage/templates/fileupload_uml.html>> {
    Actually displays the UML diagram.  The only thing we upload 
    via the form is the custom plantuml. The "event" parameter of the url
    lets us find the source files etc.
    <color:royalBlue> <form action={% url 'file_upload_uml' event %}  method="POST">
}

urls - -> views : <color:royalBlue>   <u>1.</u></color> fileupload()
views - -> fileupload : <color:royalBlue>  <u>2.</u></color> fileupload\n template render
fileupload - -> views : <color:royalBlue>   <u>3.</u></color> upload_file(data)\nonce for each file via AJAX
fileupload - -> views : <color:royalBlue>   <u>4.</u></color> file_upload_uml/[object Event]\nonce all have been uploaded
views -> fileupload_uml : <color:royalBlue>  <u>5.</u></color> fileupload_uml(image_url, form, etc.)\n template render UML
fileupload_uml -> views : <color:royalBlue>   <u>6.</u></color> file_upload_uml/[object Event] <color:royalBlue>  \nto regenerate the UML

note as N1
upload_file() is called multiple times, once for each file
passing back (in the AJAX response) the first calculated event 
to the javascript so that all subsequent files get put into the 
same event/directory
end note

N1 .. views
N1 ..[hidden] views

note as N2
views.fileupload_uml() <color:royalBlue>   <u>4.</u></color> is called automatically
after the initial file upload, to render the 
initial UML.

views.fileupload_uml() <color:royalBlue>   <u>6.</u></color> is called by the user
pressing "Generate UML" button on subsequent
renderings, as the UML is refined, by fiddling
with custom plantuml text.
  
<i>(the user cannot edit info/classes etc in 
<i> the uploaded Python files themselves) 
end note

N2 .. fileupload_uml
N2 .. views

@enduml

PlantUML version 1.2019.12(Sun Nov 03 10:24:54 UTC 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>