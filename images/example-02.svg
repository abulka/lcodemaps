<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1532px" preserveAspectRatio="none" style="width:1649px;height:1532px;" version="1.1" viewBox="0 0 1649 1532" width="1649px" zoomAndPan="magnify"><defs><filter height="300%" id="f1oef3yxcxo9k7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#FF0000" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="183" x="1454.5" y="9.668">File Upload Story - Literate Code Map</text><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="95" x="1542.5" y="21.4453">(c) Andy Bulka 2019</text><!--MD5=[2ee341e1ab3c6e48c4c7cbc2817a21d5]
class urls--><rect fill="#FEFECE" filter="url(#f1oef3yxcxo9k7)" height="115.041" id="urls" style="stroke: #A80036; stroke-width: 1.5;" width="441" x="6" y="63.0547"/><ellipse cx="21" cy="82.1875" fill="#FF7700" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M16.7139,76.2944 L19.6357,76.2944 L21.1133,81.7314 L22.5825,76.2944 L25.521,76.2944 L25.521,88.6875 L23.4126,88.6875 L23.4126,78.7598 L22.1011,84.1802 L20.1504,84.1802 L18.8223,78.7598 L18.8223,88.6875 L16.7139,88.6875 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="119" x="33" y="79.6563">«singlepage/urls.py»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="21" x="82" y="93.7891">urls</text><rect fill="#FFFFFF" height="16.1328" style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" width="292" x="158" y="60.0547"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="282" x="163" y="72.6563">START HERE: when user clicks on file upload link</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="446" y1="101.3203" y2="101.3203"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="12" y="132.9102">/fileupload -&gt;</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="85" x="98" y="132.9102">views.fileupload</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="186" y="132.9102"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="7" x="186" y="132.9102">1</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="196" y="132.9102"/><text fill="#FF0000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="120" x="199" y="132.9102">* main user start point</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="15" y="145.8652"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="83" x="12" y="158.8203">/upload_file -&gt;</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="91" x="104" y="158.8203">views.upload_file</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="186" x="12" y="171.7754">/file_upload_uml/&lt;str:event&gt;/ -&gt;</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="117" x="207" y="171.7754">views.file_upload_uml</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="7" x2="196.5" y1="115.7979" y2="115.7979"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="196.5" y="119.4551">urlpatterns</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="256.5" x2="446" y1="115.7979" y2="115.7979"/><!--MD5=[f57c53f854481d44bdae29012291a95b]
class views--><rect fill="#FEFECE" filter="url(#f1oef3yxcxo9k7)" height="933.7891" id="views" style="stroke: #A80036; stroke-width: 1.5;" width="522" x="426.25" y="287.5547"/><ellipse cx="619.5" cy="306.6875" fill="#FF7700" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M615.2139,300.7944 L618.1357,300.7944 L619.6133,306.2314 L621.0825,300.7944 L624.021,300.7944 L624.021,313.1875 L621.9126,313.1875 L621.9126,303.2598 L620.6011,308.6802 L618.6504,308.6802 L617.3223,303.2598 L617.3223,313.1875 L615.2139,313.1875 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="131" x="638" y="304.1563">« singlepage.views.py»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="31" x="688" y="318.2891">views</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="427.25" x2="947.25" y1="325.8203" y2="325.8203"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="438.25" y="357.4102"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="10" x="438.25" y="357.4102">1.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="121" x="435.25" y="370.3652">return render(request,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="4" x="456.25" y="383.3203">"</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86" x="460.25" y="383.3203">fileupload.html</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="119" x="546.25" y="383.3203">", {"object_list": None})</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="674.25" y="383.3203"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="10" x="674.25" y="383.3203">2.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="396.2754"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="427.25" x2="624.75" y1="340.2979" y2="340.2979"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="125" x="624.75" y="343.9551">def fileupload(request):</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="749.75" x2="947.25" y1="340.2979" y2="340.2979"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="438.25" y="426.1855"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="10" x="438.25" y="426.1855">3.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="369" x="432.25" y="439.1406">Calculates an "event" based on the user name and date, and stores all</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="259" x="432.25" y="452.0957">uploaded files in a directory UPLOAD_DIR/event.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="465.0508"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="328" x="435.25" y="478.0059">form = FileUploadForm(request.POST, request.FILES or None)</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="132" x="435.25" y="490.9609">file = request.FILES['file']</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="41" x="435.25" y="503.916">event =</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="479.25" y="503.916">calc_upload_eventdir</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="210" x="597.25" y="503.916">(request.user, datetime.datetime.now())</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="205" x="435.25" y="516.8711">dir = os.path.join(UPLOAD_DIR, event)</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="179" x="435.25" y="529.8262">path = os.path.join(dir, file.name)</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="542.7813"/><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119" x="435.25" y="542.7813">handle_uploaded_file</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="54" x="554.25" y="542.7813">(file, path)</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="620.25" y="542.7813"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="18" x="620.25" y="542.7813">A1.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="555.7363"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="395" x="435.25" y="568.6914">return HttpResponse(json.dumps(data), content_type="application/json")</text><text fill="#FF0000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="157" x="432.25" y="581.6465">Typical AJAX HttpResponse is</text><text fill="#808080" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="193" x="440.25" y="595.5684">&lt;class 'dict'&gt;: {'status': 'success',</text><text fill="#808080" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="142" x="508.25" y="609.7012">'file': 'display_model.py',</text><text fill="#808080" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="254" x="508.25" y="623.834">'event': 'admin-1-2019-04-17-12:12:47'}</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="637"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="427.25" x2="591.75" y1="409.0732" y2="409.0732"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="191" x="591.75" y="412.7305">def upload_file(request, uid=None):</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="782.75" x2="947.25" y1="409.0732" y2="409.0732"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="438.25" y="666.9102"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="18" x="438.25" y="666.9102">A1.</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="409" x="432.25" y="679.8652">This should be changed to using memcache rather than the local file system!</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="301" x="435.25" y="692.8203">path = os.path.join('uploaded', file.name)  # work out dir</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="282" x="435.25" y="705.7754">os.makedirs(os.path.dirname(path))  # and create dir</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="431" x="435.25" y="718.7305">with open(path, 'wb+') as destination: ... destination.write(chunk) # writes out file</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="731.6855"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="427.25" x2="573.25" y1="649.7979" y2="649.7979"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="228" x="573.25" y="653.4551">def handle_uploaded_file(file, path=None):</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="801.25" x2="947.25" y1="649.7979" y2="649.7979"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="441.25" y="761.5957"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="10" x="441.25" y="761.5957">4.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="441.25" y="774.5508"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="10" x="441.25" y="774.5508">6.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="286" x="432.25" y="787.5059">Called when all files have been successfully uploaded.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="234" x="432.25" y="800.4609">"event" gives us a way to refer to those files.</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="477" x="432.25" y="813.416">Combines custom plantumltext (which initially will be blank) into a UML diagram based on</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="912.25" y="813.416">paths</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="826.3711"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="211" x="435.25" y="839.3262">image_url, generated_plant_uml_text =</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="187" x="649.25" y="839.3262">uploaded_local_paths_to_uml_url</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="4" x="836.25" y="839.3262">(</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="447.25" y="852.2813"/><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="447.25" y="852.2813">paths</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="220" x="477.25" y="852.2813">, custom_plant_uml_text, ..., options_uml</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="4" x="447.25" y="865.2363">)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="878.1914"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="115" x="432.25" y="891.1465">then where do we go?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="265" x="432.25" y="904.1016">well, we render the "fileupload_uml.html" template</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="917.0566"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="342" x="435.25" y="930.0117">form = MyFileUploadForm(initial={"custom_plant_uml_text": ""})</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="942.9668"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="43" x="432.25" y="955.9219">which is</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="203" x="435.25" y="968.877">class MyFileUploadForm(forms.Form):</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="231" x="441.25" y="981.832">custom_plant_uml_text = forms.CharField(</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="434" x="453.25" y="994.7871">label="Additional custom plantuml text", required=False, widget=forms.Textarea</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="4" x="441.25" y="1007.7422">)</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="274" x="432.25" y="1020.6973">Note that it is not inheriting from forms.ModelForm</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="1033.6523"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="77" x="435.25" y="1046.6074">return render(</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="447.25" y="1059.5625">request,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="117" x="447.25" y="1072.5176">"fileupload_uml.html",</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="576.25" y="1072.5176"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="10" x="576.25" y="1072.5176">5.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="4" x="447.25" y="1085.4727">{</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="147" x="459.25" y="1098.4277">"python_text": python_text,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="151" x="459.25" y="1111.3828"># "show_python_text": True,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="297" x="459.25" y="1124.3379">"generated_plant_uml_text": generated_plant_uml_text,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="171" x="459.25" y="1137.293">"custom_plant_uml_text": None,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="123" x="459.25" y="1150.248">"image_url": image_url,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="69" x="459.25" y="1163.2031">"form": form,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="75" x="459.25" y="1176.1582">"event": event,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="113" x="459.25" y="1189.1133">"paths_ro": paths_ro,</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="7" x="447.25" y="1202.0684">},</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="435.25" y="1215.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="427.25" x2="591.25" y1="744.4834" y2="744.4834"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="192" x="591.25" y="748.1406">def file_upload_uml(request, event):</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="783.25" x2="947.25" y1="744.4834" y2="744.4834"/><!--MD5=[8cc017fdbdc8d0edac236ffe8a6125cc]
class fileupload--><rect fill="#FEFECE" filter="url(#f1oef3yxcxo9k7)" height="205.7266" id="fileupload" style="stroke: #A80036; stroke-width: 1.5;" width="476" x="449.25" y="1315.5547"/><ellipse cx="570.5" cy="1334.6875" fill="#FF7700" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M571.8418,1341.9375 L569.3931,1341.9375 L569.3931,1331.686 L566.2471,1331.686 L566.2471,1329.5444 L574.9878,1329.5444 L574.9878,1331.686 L571.8418,1331.686 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="229" x="589" y="1332.1563">«singlepage/templates/fileupload.html»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="57" x="675" y="1346.2891">fileupload</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="450.25" x2="924.25" y1="1353.8203" y2="1353.8203"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="411" x="455.25" y="1368.4551">Change /upload-target to your upload address, in this case it is "upload_file"</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="63" x="455.25" y="1381.4102">for each file</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="458.25" y="1394.3652"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="464.25" y="1407.3203"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="10" x="464.25" y="1407.3203">3.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="119" x="458.25" y="1420.2754">&lt;form action="{% url '</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="577.25" y="1420.2754">upload_file</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="279" x="640.25" y="1420.2754">' %}" class="dropzone" id="myAwesomeDropzone"&gt;</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="85" x="470.25" y="1433.2305">{% csrf_token %}</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="50" x="458.25" y="1446.1855">&lt;/form&gt;</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="176" x="455.25" y="1476.0957">once all files have been uploaded</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="197" x="458.25" y="1489.0508">function submit_upload_uml_event()</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="141" x="470.25" y="1502.0059">event = last_upload_event</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="129" x="470.25" y="1514.9609">window.location.href = '</text><text fill="#4169E1" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="599.25" y="1514.9609">file_upload_uml/[object Event]</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="3" x="773.25" y="1514.9609">'</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="791.25" y="1514.9609"/><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="10" x="791.25" y="1514.9609">4.</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="450.25" x2="661.25" y1="1458.9834" y2="1458.9834"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="52" x="661.25" y="1462.6406">javascript</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,2.0;" x1="713.25" x2="924.25" y1="1458.9834" y2="1458.9834"/><!--MD5=[db6ee206169267298d76e073d65969b4]
class fileupload_uml--><rect fill="#FEFECE" filter="url(#f1oef3yxcxo9k7)" height="106.0859" id="fileupload_uml" style="stroke: #A80036; stroke-width: 1.5;" width="377" x="1243" y="701.5547"/><ellipse cx="1301.25" cy="720.6875" fill="#FF7700" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1302.5918,727.9375 L1300.1431,727.9375 L1300.1431,717.686 L1296.9971,717.686 L1296.9971,715.5444 L1305.7378,715.5444 L1305.7378,717.686 L1302.5918,717.686 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="256" x="1319.75" y="718.1563">«singlepage/templates/fileupload_uml.html»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="1405.75" y="732.2891">fileupload_uml</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1244" x2="1619" y1="739.8203" y2="739.8203"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="326" x="1249" y="754.4551">Actually displays the UML diagram.  The only thing we upload</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="365" x="1249" y="767.4102">via the form is the custom plantuml. The "event" parameter of the url</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="166" x="1249" y="780.3652">lets us find the source files etc.</text><text fill="#4169E1" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="350" x="1252" y="793.3203">&lt;form action={% url 'file_upload_uml' event %}  method="POST"&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1244" x2="1619" y1="799.6406" y2="799.6406"/><path d="M482,85.0547 L482,156.2969 L893,156.2969 L893,95.0547 L883,85.0547 L482,85.0547 " fill="#FBFB77" filter="url(#f1oef3yxcxo9k7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M883,85.0547 L883,95.0547 L893,95.0547 L883,85.0547 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="346" x="488" y="102.623">upload_file() is called multiple times, once for each file</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="386" x="488" y="117.9336">passing back (in the AJAX response) the first calculated event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="379" x="488" y="133.2441">to the javascript so that all subsequent files get put into the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="488" y="148.5547">same event/directory</text><path d="M1096,31.5547 L1096,209.9707 L1431,209.9707 L1431,41.5547 L1421,31.5547 L1096,31.5547 " fill="#FBFB77" filter="url(#f1oef3yxcxo9k7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1421,31.5547 L1421,41.5547 L1431,41.5547 L1421,31.5547 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1102" y="49.123">views.fileupload_uml()</text><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1259" y="49.123"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="1259" y="49.123">4.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1275" y="49.123">is called automatically</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="1102" y="64.4336">after the initial file upload, to render the</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="1102" y="79.7441">initial UML.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1106" y="95.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1102" y="110.3652">views.fileupload_uml()</text><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1259" y="110.3652"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="1259" y="110.3652">6.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="1275" y="110.3652">is called by the user</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="1102" y="125.6758">pressing "Generate UML" button on subsequent</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="283" x="1102" y="140.9863">renderings, as the UML is refined, by fiddling</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="1102" y="156.2969">with custom plantuml text.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1110" y="171.6074"/><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="251" x="1102" y="186.918">(the user cannot edit info/classes etc in</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="239" x="1106" y="202.2285">the uploaded Python files themselves)</text><!--MD5=[09120dea1eacb4adcb82378279176969]
link urls to views--><path d="M267.566,178.1947 C304.531,228.8747 362.131,307.8347 422.941,391.2047 " fill="none" id="urls-&gt;views" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="426.208,395.6847,424.1405,386.0553,423.2634,391.6437,417.675,390.7666,426.208,395.6847" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="328.25" y="253.123"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="328.25" y="253.123">1.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="344.25" y="253.123">fileupload()</text><!--MD5=[ffe3e3ee9dc4358597c81f0535ccc61a]
link views to fileupload--><path d="M518.855,1221.6027 C522.628,1243.4327 528.933,1264.8537 538.25,1285.5547 C542.199,1294.3297 547.052,1302.7567 552.565,1310.8087 " fill="none" id="views-&gt;fileupload" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="555.694,1315.2437,553.772,1305.5842,552.8107,1311.1588,547.2361,1310.1975,555.694,1315.2437" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="555.25" y="1265.623"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="555.25" y="1265.623">2.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="571.25" y="1265.623">fileupload</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="543.25" y="1280.9336">template render</text><!--MD5=[03f9cf74cfeae6a5520877ea6bee28fb]
link fileupload to views--><path d="M684.695,1315.2297 C684.514,1305.2027 684.359,1295.1817 684.25,1285.5547 C684.031,1266.2577 683.868,1246.5657 683.753,1226.6727 " fill="none" id="fileupload-&gt;views" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="683.725,1221.6107,679.7765,1230.6334,683.7536,1226.6106,687.7764,1230.5877,683.725,1221.6107" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="713.25" y="1265.623"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="713.25" y="1265.623">3.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="729.25" y="1265.623">upload_file(data)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="685.25" y="1280.9336">once for each file via AJAX</text><!--MD5=[03f9cf74cfeae6a5520877ea6bee28fb]
link fileupload to views--><path d="M837.341,1315.3757 C844.673,1306.0397 851.108,1296.0947 856.25,1285.5547 C865.521,1266.5497 871.97,1246.9197 876.012,1226.9087 " fill="none" id="fileupload-&gt;views-1" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="876.988,1221.8137,871.3675,1229.9013,876.0481,1226.7246,879.2249,1231.4052,876.988,1221.8137" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="881.25" y="1265.623"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="881.25" y="1265.623">4.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="897.25" y="1265.623">file_upload_uml/[object Event]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="890.75" y="1280.9336">once all have been uploaded</text><!--MD5=[cddd192e01fe3b74630b2860d1a04689]
link views to fileupload_uml--><path d="M948.51,754.5547 C1043.65,754.5547 1149.42,754.5547 1237.65,754.5547 " fill="none" id="views-&gt;fileupload_uml" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1242.9,754.5547,1233.9,750.5547,1237.9,754.5547,1233.9,758.5547,1242.9,754.5547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="974.5" y="732.123"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="974.5" y="732.123">5.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="990.5" y="732.123">fileupload_uml(image_url, form, etc.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="1032" y="747.4336">template render UML</text><!--MD5=[0cca9166073524ec94a29c7be6c36ff1]
link fileupload_uml to views--><path d="M1242.94,787.6437 C1233,788.7777 1223.14,789.7627 1213.5,790.5547 C1108.96,799.1377 1082.19,797.0227 977.5,790.5547 C969.631,790.0687 961.648,789.5087 953.595,788.8867 " fill="none" id="fileupload_uml-&gt;views" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="948.572,788.4907,957.2313,793.1828,953.5567,788.882,957.8575,785.2074,948.572,788.4907" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="990.5" y="771.123"/><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="12" x="990.5" y="771.123">6.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="1006.5" y="771.123">file_upload_uml/[object Event]</text><text fill="#4169E1" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1211.5" y="771.123"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="1026" y="786.4336">to regenerate the UML</text><!--MD5=[f67dbca5065fe18d82e69bde4cf3096d]
link N1 to views--><path d="M681.015,156.4347 C678.67,186.2547 676.958,232.9147 675.879,287.3047 " fill="none" id="N1-views" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--MD5=[f67dbca5065fe18d82e69bde4cf3096d]
link N1 to views--><!--MD5=[58aab5ad28c64ade5f22c16225310adb]
link N2 to fileupload_uml--><path d="M1286.7,209.7647 C1322.25,343.5047 1388.69,593.4317 1417.42,701.5277 " fill="none" id="N2-fileupload_uml" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--MD5=[80318a571f26cbb2d05b564a67b90dfb]
link N2 to views--><path d="M1182.86,209.7647 C1121.52,277.0547 1033.38,373.7747 948.389,467.0247 " fill="none" id="N2-views" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--MD5=[7e00dec61a31f4c3c82e1146c1203343]
@startuml More complete example of a Literate Code Map - 02


header
<font color=red>File Upload Story - Literate Code Map</font>
(c) Andy Bulka 2019
endheader

class urls < START HERE: when user clicks on file upload link ><<(M,#FF7700) singlepage/urls.py>>{
    .. urlpatterns ..
    /fileupload -> <color:royalBlue>  views.fileupload</color> <u>1</u> <color:Red> * main user start point
    
    /upload_file -> <color:royalBlue>  views.upload_file
    /file_upload_uml/<str:event>/ -> <color:royalBlue>  views.file_upload_uml
}

class views <<(M,#FF7700)  singlepage.views.py>> {
    .. def fileupload(request): ..
        <color:royalBlue>  <u>1.</u></color>
        <color:royalBlue> return render(request, 
        <color:royalBlue>\t"<b>fileupload.html</b>", {"object_list": None}) <color:royalBlue>  <u>2.</u></color>

    .. def upload_file(request, uid=None): ..
    <color:royalBlue>  <u>3.</u></color>
    Calculates an "event" based on the user name and date, and stores all
    uploaded files in a directory UPLOAD_DIR/event.
      
    <color:royalBlue> form = FileUploadForm(request.POST, request.FILES or None)
    <color:royalBlue> file = request.FILES['file']
    <color:royalBlue> event = <b>calc_upload_eventdir</b>(request.user, datetime.datetime.now())
    <color:royalBlue> dir = os.path.join(UPLOAD_DIR, event)
    <color:royalBlue> path = os.path.join(dir, file.name)
    <color:royalBlue> <b>handle_uploaded_file</b>(file, path)  <color:royalBlue>  <u>A1.</u></color>

    <color:royalBlue> return HttpResponse(json.dumps(data), content_type="application/json")
    <color:Red>Typical AJAX HttpResponse is
    <color:Gray><size:12>  <class 'dict'>: {'status': 'success', 
    <color:Gray><size:12>                   'file': 'display_model.py', 
    <color:Gray><size:12>                   'event': 'admin-1-2019-04-17-12:12:47'}

    .. def handle_uploaded_file(file, path=None): ..
    <color:royalBlue>  <u>A1.</u></color>
    <i>This should be changed to using memcache rather than the local file system!</i>
    <color:royalBlue> path = os.path.join('uploaded', file.name)  # work out dir 
    <color:royalBlue> os.makedirs(os.path.dirname(path))  # and create dir
    <color:royalBlue> with open(path, 'wb+') as destination: ... destination.write(chunk) # writes out file
    
    .. def file_upload_uml(request, event): ..
    <color:royalBlue>   <u>4.</u></color>
    <color:royalBlue>   <u>6.</u></color>
    Called when all files have been successfully uploaded.
    "event" gives us a way to refer to those files.
    Combines custom plantumltext (which initially will be blank) into a UML diagram based on <b>paths</b>
    
    <color:royalBlue> image_url, generated_plant_uml_text = <b>uploaded_local_paths_to_uml_url</b>(
    <color:royalBlue>     <b>paths</b>, custom_plant_uml_text, ..., options_uml
    <color:royalBlue>     )
    
    then where do we go?
    well, we render the "fileupload_uml.html" template
    
    <color:royalBlue> form = MyFileUploadForm(initial={"custom_plant_uml_text": ""})

    which is
    <color:royalBlue> class MyFileUploadForm(forms.Form):
    <color:royalBlue>   custom_plant_uml_text = forms.CharField(
    <color:royalBlue>       label="Additional custom plantuml text", required=False, widget=forms.Textarea
    <color:royalBlue>   )
    Note that it is not inheriting from forms.ModelForm
     
    <color:royalBlue> return render(
    <color:royalBlue>     request,
    <color:royalBlue>     "fileupload_uml.html",  <color:royalBlue>  <u>5.</u></color>
    <color:royalBlue>     {
    <color:royalBlue>         "python_text": python_text,
    <color:royalBlue>         # "show_python_text": True,
    <color:royalBlue>         "generated_plant_uml_text": generated_plant_uml_text,
    <color:royalBlue>         "custom_plant_uml_text": None,
    <color:royalBlue>         "image_url": image_url,
    <color:royalBlue>         "form": form,
    <color:royalBlue>         "event": event,
    <color:royalBlue>         "paths_ro": paths_ro,
    <color:royalBlue>     },    
    <color:royalBlue> 
}

class fileupload <<(T,#FF7700) singlepage/templates/fileupload.html>> {
    Change /upload-target to your upload address, in this case it is "upload_file"
    for each file

    <color:royalBlue>   <u>3.</u></color>
    <color:royalBlue> <form action="{% url '<b>upload_file</b>' %}" class="dropzone" id="myAwesomeDropzone">
    <color:royalBlue>     {% csrf_token %}
    <color:royalBlue> </form>
    .. javascript ..
    once all files have been uploaded
    <color:royalBlue> function submit_upload_uml_event()
    <color:royalBlue>     event = last_upload_event
    <color:royalBlue>     window.location.href = '<b>file_upload_uml/[object Event]</b>'  <color:royalBlue>   <u>4.</u></color>
}

class fileupload_uml <<(T,#FF7700) singlepage/templates/fileupload_uml.html>> {
    Actually displays the UML diagram.  The only thing we upload 
    via the form is the custom plantuml. The "event" parameter of the url
    lets us find the source files etc.
    <color:royalBlue> <form action={% url 'file_upload_uml' event %}  method="POST">
}

urls - -> views : <color:royalBlue>   <u>1.</u></color> fileupload()
views - -> fileupload : <color:royalBlue>  <u>2.</u></color> fileupload\n template render
fileupload - -> views : <color:royalBlue>   <u>3.</u></color> upload_file(data)\nonce for each file via AJAX
fileupload - -> views : <color:royalBlue>   <u>4.</u></color> file_upload_uml/[object Event]\nonce all have been uploaded
views -> fileupload_uml : <color:royalBlue>  <u>5.</u></color> fileupload_uml(image_url, form, etc.)\n template render UML
fileupload_uml -> views : <color:royalBlue>   <u>6.</u></color> file_upload_uml/[object Event] <color:royalBlue>  \nto regenerate the UML

note as N1
upload_file() is called multiple times, once for each file
passing back (in the AJAX response) the first calculated event 
to the javascript so that all subsequent files get put into the 
same event/directory
end note

N1 .. views
N1 ..[hidden] views

note as N2
views.fileupload_uml() <color:royalBlue>   <u>4.</u></color> is called automatically
after the initial file upload, to render the 
initial UML.

views.fileupload_uml() <color:royalBlue>   <u>6.</u></color> is called by the user
pressing "Generate UML" button on subsequent
renderings, as the UML is refined, by fiddling
with custom plantuml text.
  
<i>(the user cannot edit info/classes etc in 
<i> the uploaded Python files themselves) 
end note

N2 .. fileupload_uml
N2 .. views

@enduml

PlantUML version 1.2019.12(Sun Nov 03 21:24:54 AEDT 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_221-b11
Operating System: Mac OS X
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>